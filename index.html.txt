import React, { useState } from 'react';
import { 
  Atom, 
  ChevronRight, 
  BookOpen, 
  CheckCircle, 
  ArrowLeft, 
  Microscope, 
  List, 
  PlayCircle,
  Award,
  Info
} from 'lucide-react';

// --- CONFIGURACIÓN DEL TRIMESTRE 1 ---
const trimesterData = {
  info: {
    title: "Primer Trimestre",
    topic: "Estructura Atómica y Periodicidad",
    grade: "1ero Bachillerato",
    description: "Este trimestre sienta las bases de la química moderna. Viajaremos desde la concepción filosófica del átomo hasta el modelo mecano-cuántico actual, y entenderemos cómo la configuración electrónica dicta el comportamiento de los elementos en la tabla periódica.",
    color: "from-blue-600 to-indigo-600",
    accent: "text-blue-600",
    outcomes: [
      "Describir la evolución de los modelos atómicos (Dalton a Mecano-Cuántico).",
      "Calcular números cuánticos y realizar configuraciones electrónicas.",
      "Relacionar la estructura electrónica con la posición en la Tabla Periódica.",
      "Identificar propiedades periódicas: Radio atómico, Energía de ionización y Electronegatividad."
    ]
  },
  lessons: [
    {
      id: 1,
      title: "1. Evolución de los Modelos Atómicos",
      duration: "45 min",
      content: (
        <div className="space-y-6 text-gray-700 leading-relaxed">
          <p className="text-lg">
            La idea del átomo comenzó en Grecia con Demócrito ("a-tomos", sin división), pero la ciencia moderna retomó el concepto siglos después.
          </p>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
              <h4 className="font-bold text-blue-800 mb-2">J. Dalton (1803)</h4>
              <p className="text-sm">Imaginó el átomo como una esfera sólida e indivisible, como una bola de billar. Postuló que átomos del mismo elemento son idénticos en masa.</p>
            </div>
            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
              <h4 className="font-bold text-blue-800 mb-2">J.J. Thomson (1904)</h4>
              <p className="text-sm">Descubrió el electrón. Propuso el modelo del "Budín de Pasas": una esfera positiva con electrones negativos incrustados.</p>
            </div>
            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
              <h4 className="font-bold text-blue-800 mb-2">E. Rutherford (1911)</h4>
              <p className="text-sm">Experimento de la lámina de oro. Descubrió que el átomo es mayormente vacío y tiene un núcleo denso y positivo. Modelo planetario.</p>
            </div>
            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
              <h4 className="font-bold text-blue-800 mb-2">Niels Bohr (1913)</h4>
              <p className="text-sm">Propuso que los electrones giran en órbitas circulares de energía definida. Introdujo la cuantización de la energía.</p>
            </div>
          </div>
        </div>
      ),
      quiz: {
        question: "¿Qué científico descubrió que el átomo tiene un núcleo denso y carga positiva?",
        options: ["J.J. Thomson", "John Dalton", "Ernest Rutherford", "Niels Bohr"],
        correct: 2
      }
    },
    {
      id: 2,
      title: "2. El Modelo Mecano-Cuántico",
      duration: "60 min",
      content: (
        <div className="space-y-6 text-gray-700 leading-relaxed">
          <p>
            El modelo actual no ve al electrón como una partícula girando, sino como una onda de probabilidad. Heisenberg introdujo el <strong>Principio de Incertidumbre</strong>: no podemos saber la posición y velocidad del electrón al mismo tiempo.
          </p>
          <div className="bg-indigo-50 p-6 rounded-xl border-l-4 border-indigo-500">
            <h4 className="font-bold text-indigo-900 mb-2">Los Números Cuánticos</h4>
            <ul className="list-disc pl-5 space-y-2">
              <li><strong>n (Principal):</strong> Nivel de energía (1, 2, 3...). Tamaño del orbital.</li>
              <li><strong>l (Secundario):</strong> Forma del orbital (s=0, p=1, d=2, f=3).</li>
              <li><strong>ml (Magnético):</strong> Orientación espacial del orbital.</li>
              <li><strong>ms (Spin):</strong> Giro del electrón (+1/2, -1/2).</li>
            </ul>
          </div>
        </div>
      ),
      quiz: {
        question: "¿Qué número cuántico indica la forma geométrica del orbital (s, p, d, f)?",
        options: ["Principal (n)", "Secundario (l)", "Magnético (ml)", "Spin (ms)"],
        correct: 1
      }
    },
    {
      id: 3,
      title: "3. Configuración Electrónica",
      duration: "50 min",
      content: (
        <div className="space-y-6 text-gray-700 leading-relaxed">
          <p>
            Es la distribución de electrones en los orbitales. Seguimos el <strong>Diagrama de Moeller</strong> (Regla de las diagonales) y el Principio de exclusión de Pauli.
          </p>
          <div className="bg-gray-800 text-white p-6 rounded-xl font-mono text-sm overflow-x-auto">
            <p className="mb-2 text-gray-400">// Ejemplo: Carbono (Z=6)</p>
            <p>1s² 2s² 2p²</p>
            <br/>
            <p className="mb-2 text-gray-400">// Ejemplo: Cloro (Z=17)</p>
            <p>1s² 2s² 2p⁶ 3s² 3p⁵</p>
          </div>
          <p className="text-sm italic">
            Nota: Los exponentes suman el número total de electrones (Z en átomos neutros).
          </p>
        </div>
      ),
      quiz: {
        question: "¿Cuál es la configuración electrónica correcta del Sodio (Na, Z=11)?",
        options: ["1s² 2s² 2p⁶ 3s²", "1s² 2s² 2p⁶ 3s¹", "1s² 2s² 2p⁵ 3s²", "1s² 2s² 2p⁶"],
        correct: 1
      }
    },
    {
      id: 4,
      title: "4. Tabla Periódica y Propiedades",
      duration: "40 min",
      content: (
        <div className="space-y-6 text-gray-700 leading-relaxed">
          <p>
            La tabla se organiza por Número Atómico (Z) creciente.
          </p>
          <ul className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <li className="bg-white p-4 shadow-sm rounded-lg border">
              <strong>Grupos (Columnas):</strong> Elementos con la misma configuración electrónica externa (valencia).
            </li>
            <li className="bg-white p-4 shadow-sm rounded-lg border">
              <strong>Periodos (Filas):</strong> Indican el último nivel de energía (n).
            </li>
          </ul>
          <h4 className="font-bold text-gray-900 mt-4">Propiedades Periódicas</h4>
          <p>
            <strong>Electronegatividad:</strong> Capacidad de atraer electrones. Aumenta hacia arriba y a la derecha. El Flúor (F) es el rey.
          </p>
        </div>
      ),
      quiz: {
        question: "En la tabla periódica, ¿cómo varía el radio atómico?",
        options: [
          "Aumenta hacia la derecha y arriba",
          "Aumenta hacia la izquierda y abajo",
          "No cambia",
          "Aumenta solo en los gases nobles"
        ],
        correct: 1
      }
    }
  ]
};

// --- COMPONENTES ---

const ProgressBar = ({ current, total }) => {
  const percentage = Math.round((current / total) * 100);
  return (
    <div className="w-full bg-gray-200 rounded-full h-2.5 mb-6">
      <div 
        className="bg-blue-600 h-2.5 rounded-full transition-all duration-500 ease-out" 
        style={{ width: `${percentage}%` }}
      ></div>
      <div className="flex justify-between text-xs text-gray-500 mt-1">
        <span>Progreso del Trimestre</span>
        <span>{percentage}%</span>
      </div>
    </div>
  );
};

const Quiz = ({ data, onComplete }) => {
  const [selected, setSelected] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);

  const handleCheck = () => {
    if (selected === data.correct) {
      setIsCorrect(true);
      onComplete();
    } else {
      setIsCorrect(false);
    }
  };

  return (
    <div className="mt-8 border-t pt-6">
      <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
        <CheckCircle size={20} className="text-blue-600" /> Evaluación Rápida
      </h3>
      <p className="mb-4 text-gray-700 font-medium">{data.question}</p>
      <div className="space-y-3">
        {data.options.map((opt, idx) => (
          <button
            key={idx}
            onClick={() => { setSelected(idx); setIsCorrect(null); }}
            className={`w-full text-left p-4 rounded-lg border transition-all ${
              selected === idx 
                ? 'border-blue-500 bg-blue-50 text-blue-900 font-medium' 
                : 'border-gray-200 hover:bg-gray-50'
            }`}
          >
            {opt}
          </button>
        ))}
      </div>

      {selected !== null && isCorrect === null && (
        <button 
          onClick={handleCheck}
          className="mt-4 w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition shadow-md"
        >
          Verificar Respuesta
        </button>
      )}

      {isCorrect === true && (
        <div className="mt-4 p-4 bg-green-100 text-green-800 rounded-lg flex items-center gap-2 font-bold animate-in fade-in slide-in-from-bottom-2">
          <Award size={20} /> ¡Correcto! Lección completada.
        </div>
      )}
      
      {isCorrect === false && (
        <div className="mt-4 p-4 bg-red-100 text-red-800 rounded-lg text-center font-medium animate-pulse">
          Respuesta incorrecta. Intenta de nuevo.
        </div>
      )}
    </div>
  );
};

// --- VISTAS PRINCIPALES ---

const CoverView = ({ onStart }) => (
  <div className={`min-h-[500px] flex flex-col items-center justify-center text-center p-8 rounded-3xl bg-gradient-to-br ${trimesterData.info.color} text-white shadow-2xl`}>
    <div className="bg-white/20 backdrop-blur-md p-8 rounded-full mb-6 shadow-inner">
      <Atom size={80} className="text-white" />
    </div>
    <div className="inline-block px-4 py-1 rounded-full bg-white/20 backdrop-blur-sm text-sm font-medium mb-4">
      {trimesterData.info.grade}
    </div>
    <h1 className="text-5xl font-extrabold mb-2 tracking-tight">{trimesterData.info.title}</h1>
    <h2 className="text-2xl font-light opacity-90 mb-8 max-w-lg leading-snug">{trimesterData.info.topic}</h2>
    
    <button 
      onClick={onStart}
      className="group bg-white text-blue-700 px-10 py-4 rounded-full font-bold text-lg shadow-xl hover:shadow-2xl hover:scale-105 transition-all flex items-center gap-3"
    >
      Iniciar Trimestre <ChevronRight className="group-hover:translate-x-1 transition-transform" />
    </button>
  </div>
);

const IntroductionView = ({ onNext }) => (
  <div className="bg-white rounded-3xl shadow-xl p-8 md:p-12 animate-in fade-in slide-in-from-bottom-8">
    <div className="flex items-center gap-3 mb-6">
      <div className="bg-blue-100 p-3 rounded-xl">
        <Info size={24} className="text-blue-600" />
      </div>
      <h2 className="text-2xl font-bold text-gray-900">Introducción al Trimestre</h2>
    </div>
    
    <p className="text-gray-600 text-lg leading-relaxed mb-8">
      {trimesterData.info.description}
    </p>

    <div className="bg-blue-50 rounded-2xl p-6 mb-8 border border-blue-100">
      <h3 className="font-bold text-blue-900 mb-4 flex items-center gap-2">
        <CheckCircle size={18} /> Resultados de Aprendizaje
      </h3>
      <ul className="space-y-3">
        {trimesterData.info.outcomes.map((outcome, idx) => (
          <li key={idx} className="flex items-start gap-3 text-gray-700">
            <span className="min-w-[6px] h-[6px] mt-2 rounded-full bg-blue-500"></span>
            {outcome}
          </li>
        ))}
      </ul>
    </div>

    <button onClick={onNext} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition shadow-lg flex justify-center items-center gap-2">
      Ir al Índice de Contenidos <ChevronRight />
    </button>
  </div>
);

const IndexView = ({ progress, onSelectLesson }) => (
  <div className="animate-in fade-in duration-500">
    <div className="flex items-center gap-3 mb-6">
      <List size={28} className="text-gray-700" />
      <h2 className="text-2xl font-bold text-gray-900">Índice de Contenidos</h2>
    </div>

    <ProgressBar current={progress.length} total={trimesterData.lessons.length} />

    <div className="space-y-4">
      {trimesterData.lessons.map((lesson, idx) => {
        const isCompleted = progress.includes(lesson.id);
        const isLocked = idx > 0 && !progress.includes(trimesterData.lessons[idx - 1].id);

        return (
          <div 
            key={lesson.id}
            onClick={() => !isLocked && onSelectLesson(lesson)}
            className={`group relative p-6 rounded-2xl border transition-all duration-300
              ${isLocked 
                ? 'bg-gray-50 border-gray-200 opacity-70 cursor-not-allowed' 
                : isCompleted
                  ? 'bg-green-50 border-green-200 cursor-pointer'
                  : 'bg-white border-gray-200 hover:border-blue-300 hover:shadow-lg cursor-pointer'
              }`}
          >
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-4">
                <div className={`w-12 h-12 rounded-xl flex items-center justify-center font-bold text-lg
                  ${isCompleted ? 'bg-green-100 text-green-700' : isLocked ? 'bg-gray-200 text-gray-400' : 'bg-blue-100 text-blue-600'}`}>
                  {isCompleted ? <CheckCircle size={24} /> : idx + 1}
                </div>
                <div>
                  <h3 className={`font-bold text-lg ${isCompleted ? 'text-green-800' : 'text-gray-800'}`}>{lesson.title}</h3>
                  <div className="flex items-center text-xs text-gray-500 mt-1 font-medium uppercase tracking-wide">
                    <PlayCircle size={12} className="mr-1" /> {lesson.duration}
                  </div>
                </div>
              </div>
              
              {!isLocked && !isCompleted && (
                <ChevronRight className="text-gray-300 group-hover:text-blue-500 transition-colors" />
              )}
            </div>
          </div>
        );
      })}
    </div>
  </div>
);

const LessonView = ({ lesson, onBack, onComplete, isCompleted }) => (
  <div className="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden animate-in slide-in-from-right duration-300">
    {/* Lesson Header */}
    <div className="bg-gray-50 p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 z-10">
      <button onClick={onBack} className="flex items-center text-gray-500 hover:text-blue-600 font-medium transition">
        <ArrowLeft size={18} className="mr-1" /> Volver
      </button>
      <span className="text-xs font-bold uppercase text-gray-400 tracking-wider">Unidad Didáctica</span>
    </div>

    <div className="p-8 md:p-10">
      <h1 className="text-3xl md:text-4xl font-bold text-gray-900 mb-8">{lesson.title}</h1>
      
      <div className="prose prose-blue max-w-none mb-10">
        {lesson.content}
      </div>

      {!isCompleted ? (
        <Quiz data={lesson.quiz} onComplete={() => { onComplete(lesson.id); }} />
      ) : (
        <div className="mt-8 p-6 bg-green-50 rounded-xl border border-green-100 text-center">
          <Award size={48} className="mx-auto text-green-500 mb-3" />
          <h3 className="text-xl font-bold text-green-800">¡Lección Aprobada!</h3>
          <p className="text-green-600 mb-4">Has completado este tema con éxito.</p>
          <button onClick={onBack} className="px-6 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700">
            Continuar al Índice
          </button>
        </div>
      )}
    </div>
  </div>
);

const EndScreen = ({ onRestart }) => (
  <div className="min-h-[500px] flex flex-col items-center justify-center text-center p-8 bg-white rounded-3xl shadow-xl">
    <div className="relative">
      <div className="absolute inset-0 bg-yellow-200 blur-xl opacity-50 rounded-full"></div>
      <Award size={80} className="text-yellow-500 relative z-10 mb-6" />
    </div>
    <h2 className="text-4xl font-extrabold text-gray-900 mb-4">¡Trimestre Completado!</h2>
    <p className="text-xl text-gray-600 max-w-md mb-8">
      Has dominado los conceptos de Estructura Atómica y Tabla Periódica. Estás listo para el siguiente nivel.
    </p>
    <button 
      onClick={onRestart}
      className="bg-gray-900 text-white px-8 py-3 rounded-full font-bold hover:bg-gray-800 transition shadow-lg"
    >
      Repasar Trimestre 1
    </button>
  </div>
);

// --- APP PRINCIPAL ---

export default function FirstTrimesterApp() {
  const [view, setView] = useState('cover'); // cover, intro, index, lesson, end
  const [completedLessons, setCompletedLessons] = useState([]);
  const [activeLesson, setActiveLesson] = useState(null);

  const handleStart = () => setView('intro');
  const handleIntroNext = () => setView('index');
  
  const handleSelectLesson = (lesson) => {
    setActiveLesson(lesson);
    setView('lesson');
  };

  const handleLessonComplete = (id) => {
    if (!completedLessons.includes(id)) {
      const newCompleted = [...completedLessons, id];
      setCompletedLessons(newCompleted);
      
      // Check if all finished
      if (newCompleted.length === trimesterData.lessons.length) {
        setTimeout(() => setView('end'), 2000);
      }
    }
  };

  const handleRestart = () => {
    setCompletedLessons([]);
    setActiveLesson(null);
    setView('cover');
  };

  return (
    <div className="min-h-screen bg-gray-100 py-6 md:py-10 px-4 font-sans text-slate-800">
      <div className="max-w-4xl mx-auto">
        
        {/* Navigation / Header */}
        <div className="flex justify-between items-center mb-6 px-2">
          <div className="flex items-center gap-2 text-gray-500">
            <Microscope size={20} />
            <span className="font-semibold text-sm tracking-wide uppercase">Química I</span>
          </div>
          {view !== 'cover' && (
             <div className="text-xs font-bold bg-blue-100 text-blue-700 px-3 py-1 rounded-full">
               Trimestre 1
             </div>
          )}
        </div>

        {/* Dynamic Content */}
        {view === 'cover' && <CoverView onStart={handleStart} />}
        
        {view === 'intro' && <IntroductionView onNext={handleIntroNext} />}
        
        {view === 'index' && (
          <IndexView 
            progress={completedLessons} 
            onSelectLesson={handleSelectLesson} 
          />
        )}
        
        {view === 'lesson' && activeLesson && (
          <LessonView 
            lesson={activeLesson}
            isCompleted={completedLessons.includes(activeLesson.id)}
            onBack={() => setView('index')}
            onComplete={handleLessonComplete}
          />
        )}
        
        {view === 'end' && <EndScreen onRestart={handleRestart} />}

      </div>
    </div>
  );
}